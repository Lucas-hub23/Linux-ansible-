#update cache
- name: 1. Update apt cache
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600

#installeer de benodigde paketten voor het ophalen en toevoegen van de docker repo en gpg steutel
- name: 2. Installeer benodigde pakketten 
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop:
    - apt-transport-https
    - ca-certificates
    - curl
    - gnupg
    - lsb-release

#voegt de GPG-sleutel toe
- name: 3. Voeg Docker's officiÃ«le GPG-sleutel toe
  ansible.builtin.shell: |
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
  args:
    creates: /usr/share/keyrings/docker-archive-keyring.gpg

#voegt de repo toe zodat de docker deps hieruit gehaald kunnen worden
- name: 4. Stel de Docker Repo in
  ansible.builtin.apt_repository:
    repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
    state: present
    filename: docker

#update de cache zodat de toegevoegde docker repo ook gebruikt kan worden
- name: 4b. Ververs APT cache om nieuwe Docker Repository te vindenn gg
  ansible.builtin.apt:
    update_cache: yes 

#installeer docker & co 
- name: 5. Installeer Docker Engine, CLI, en Containerd
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop:
    - docker-ce
    - docker-ce-cli
    - containerd.io

#test of docker draait... 
- name: 6. Test of de Docker Service draait
  ansible.builtin.service:
    name: docker
    state: started
    enabled: yes